<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>مینی‌گیم تصویر به عددx5</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* کوچکتر کردن مربع‌ها و استایل متن خروجی */
    .input-pixel {
      width: 56px; /* w-14 */
      height: 56px;
    }
    .output-pixel {
      width: 56px;
      height: 56px;
      background: #f8fafc; /* روشن و بی‌رنگ */
    }
    .output-text {
      white-space: pre-wrap;
      text-align: center;
      font-size: 12px; /* کمی بزرگ‌تر */
      line-height: 1.05;
      font-weight: 600;
      color: #0f172a; /* متن تیره */
    }

    /* overlay و popup */
    #overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      z-index: 50;
    }
    #colorPopup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: #ffffff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.2);
      display: none;
      z-index: 60;
      min-width: 320px;
    }

    /* باکس انتخاب رنگ بزرگ */
    #colorPicker {
      width: 160px;
      height: 160px;
      border-radius: 8px;
      border: 2px solid #e6e6e6; /* حاشیه برای وضوح */
      padding: 0;
      appearance: none;
      cursor: pointer;
    }

    /* استایل برای رنگ‌های پیش‌فرض */
    .preset-color {
      border: 1px solid #e6e6e6;
      transition: transform 0.2s, border-width 0.2s;
    }
    .preset-color:hover {
      transform: scale(1.1);
    }
    .preset-color.selected {
      border-width: 3px;
      border-color: #4f46e5; /* حاشیه آبی برای رنگ انتخاب‌شده */
    }

    /* متن راهنما */
    .color-guide {
      font-size: 14px;
      color: #1f2937;
      font-weight: 500;
      text-align: center;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <!-- صفحه مینیمال: ورودی - مبدل - خروجی -->
  <div class="flex flex-col md:flex-row items-center gap-6 p-4">

    <!-- ورودی 5x5 -->
    <div class="flex flex-col items-center gap-3 order-1">
      <div id="inputGrid" class="grid grid-cols-5 gap-2"></div>
    </div>

    <!-- Converter Section -->
    <div class="flex items-center justify-center gap-4 order-2">
        <!-- فلش چپ -->
        <svg class="hidden md:block arrow-icon fill-indigo-600 w-20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 108.06">
          <path d="M58.94,24.28a14.27,14.27,0,0,1,20.35-20l39.49,40.16a14.28,14.28,0,0,1,0,20L80.09,103.79a14.27,14.27,0,1,1-20.35-20L74.82,68.41l-60.67-.29a14.27,14.27,0,0,1,.24-28.54l59.85.28Z"/>
        </svg>

        <!-- مستطیل -->
        <div id="converterRect" 
            class="rotate-subtle w-48 h-28 bg-gradient-to-br from-indigo-500 to-purple-600 text-white font-bold rounded-2xl shadow-2xl flex items-center justify-center text-lg">
          مبدل
        </div>

        <!-- فلش راست -->
        <svg class="hidden md:block arrow-icon fill-indigo-600 w-20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 108.06">
          <path d="M58.94,24.28a14.27,14.27,0,0,1,20.35-20l39.49,40.16a14.28,14.28,0,0,1,0,20L80.09,103.79a14.27,14.27,0,1,1-20.35-20L74.82,68.41l-60.67-.29a14.27,14.27,0,0,1,.24-28.54l59.85.28Z"/>
        </svg>
    </div>

    <!-- خروجی 5x5 -->
    <div class="flex flex-col items-center gap-3 order-3">
      <div id="outputGrid" class="grid grid-cols-5 gap-2"></div>
    </div>

  </div>

  <!-- overlay و popup انتخاب رنگ -->
  <div id="overlay"></div>

  <div id="colorPopup" class="flex flex-col items-center gap-4">
    <div class="color-guide">برای انتخاب رنگ دلخواه، روی مربع کلیک کنید</div>
    <input id="colorPicker" type="color" value="#ffffff">
    <div class="flex flex-col gap-2 items-center">
      <div class="mt-2 flex justify-center">
        <button id="applyColorBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">تأیید</button>
        <button id="cancelColorBtn" class="px-3 py-2 ml-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">انصراف</button>
      </div>
      <!-- رنگ‌های پیش‌فرض -->
      <div id="presetColors" class="flex gap-2 mt-4">
        <div class="preset-color w-8 h-8 rounded-md cursor-pointer" style="background: #ff0000;" data-color="#ff0000"></div>
        <div class="preset-color w-8 h-8 rounded-md cursor-pointer" style="background: #00ff00;" data-color="#00ff00"></div>
        <div class="preset-color w-8 h-8 rounded-md cursor-pointer" style="background: #0000ff;" data-color="#0000ff"></div>
        <div class="preset-color w-8 h-8 rounded-md cursor-pointer" style="background: #ffff00;" data-color="#ffff00"></div>
        <div class="preset-color w-8 h-8 rounded-md cursor-pointer" style="background: #000000;" data-color="#000000"></div>
      </div>
    </div>
  </div>

<script>
  const ROWS = 5, COLS = 5;
  const inputGrid = document.getElementById('inputGrid');
  const outputGrid = document.getElementById('outputGrid');
  const overlay = document.getElementById('overlay');
  const colorPopup = document.getElementById('colorPopup');
  const colorPicker = document.getElementById('colorPicker');
  const applyColorBtn = document.getElementById('applyColorBtn');
  const cancelColorBtn = document.getElementById('cancelColorBtn');

  // ذخیره رنگ‌ها به صورت رشته 'rgb(r,g,b)'
  let colors = Array.from({length: ROWS}, () => Array(COLS).fill('rgb(255,255,255)'));
  let current = null; // {r, c, elem}
  let selectedColor = '#ffffff'; // رنگ انتخاب‌شده موقت

  // تبدیل hex -> rgb object
  function hexToRgb(hex) {
    const bigint = parseInt(hex.slice(1), 16);
    return {
      r: (bigint >> 16) & 255,
      g: (bigint >> 8) & 255,
      b: bigint & 255
    };
  }
  // تبدیل rgb string -> hex (برای مقداردهی به input[type=color])
  function rgbToHex(rgbStr) {
    const parts = rgbStr.match(/\d+/g).map(Number);
    const hex = "#" + ((1 << 24) + (parts[0] << 16) + (parts[1] << 8) + parts[2]).toString(16).slice(1);
    return hex;
  }

  // ساخت شبکه ورودی 5x5
  for (let r=0; r<ROWS; r++) {
    for (let c=0; c<COLS; c++) {
      const d = document.createElement('div');
      d.className = "input-pixel border rounded-sm cursor-pointer flex items-center justify-center";
      d.style.background = colors[r][c];
      d.dataset.r = r; d.dataset.c = c;
      // کلیک برای باز کردن پاپ‌آپ رنگ
      d.addEventListener('click', (e) => {
        current = { r, c, elem: d };
        // مقدار اولیه رنگ انتخاب‌شده همان رنگ فعلی مربع
        selectedColor = rgbToHex(colors[r][c]);
        colorPicker.value = selectedColor;
        updatePresetSelection();
        overlay.style.display = 'block';
        colorPopup.style.display = 'flex';
      });
      inputGrid.appendChild(d);
    }
  }

  // ساخت شبکه خروجی 5x5 (فقط متن)
  for (let r=0; r<ROWS; r++) {
    for (let c=0; c<COLS; c++) {
      const d = document.createElement('div');
      d.className = "output-pixel border rounded-sm flex items-center justify-center";
      const txt = document.createElement('div');
      txt.className = "output-text";
      txt.textContent = formatRgbText(colors[r][c]);
      d.appendChild(txt);
      outputGrid.appendChild(d);
    }
  }

  // وقتی رنگ داخل انتخابگر تغییر می‌کند، رنگ انتخاب‌شده را آپدیت کن
  colorPicker.addEventListener('input', () => {
    selectedColor = colorPicker.value;
    updatePresetSelection();
  });

  // مدیریت کلیک روی رنگ‌های پیش‌فرض
  const presetColors = document.querySelectorAll('.preset-color');
  presetColors.forEach(preset => {
    preset.addEventListener('click', () => {
      selectedColor = preset.dataset.color;
      colorPicker.value = selectedColor;
      updatePresetSelection();
    });
  });

  // به‌روزرسانی نشانه‌گذاری رنگ انتخاب‌شده
  function updatePresetSelection() {
    presetColors.forEach(preset => {
      preset.classList.toggle('selected', preset.dataset.color === selectedColor);
    });
  }

  // تایید رنگ: اعمال رنگ انتخاب‌شده به مربع ورودی
  applyColorBtn.addEventListener('click', () => {
    if (current) {
      const {r,g,b} = hexToRgb(selectedColor);
      const rgbStr = `rgb(${r},${g},${b})`;
      colors[current.r][current.c] = rgbStr;
      current.elem.style.background = rgbStr;
      // آپدیت متن خروجی
      updateOutputs();
      current = null;
    }
    overlay.style.display = 'none';
    colorPopup.style.display = 'none';
  });

  // لغو
  cancelColorBtn.addEventListener('click', () => {
    current = null;
    selectedColor = '#ffffff';
    colorPicker.value = selectedColor;
    updatePresetSelection();
    overlay.style.display = 'none';
    colorPopup.style.display = 'none';
  });

  // کلیک روی overlay هم پاپ‌آپ بسته شود
  overlay.addEventListener('click', () => {
    current = null;
    selectedColor = '#ffffff';
    colorPicker.value = selectedColor;
    updatePresetSelection();
    overlay.style.display = 'none';
    colorPopup.style.display = 'none';
  });

  // فرمت متن RGB به شکل چندخطی [R, \n G, \n B]
  function formatRgbText(rgbStr) {
    const nums = rgbStr.match(/\d+/g).map(Number);
    return `[${nums[0]},\n${nums[1]},\n${nums[2]}]`;
  }

  // آپدیت همه خروجی‌ها (فقط متن) — بدون تغییر رنگ پس‌زمینه
  function updateOutputs() {
    const children = outputGrid.children;
    let idx = 0;
    for (let r=0; r<ROWS; r++) {
      for (let c=0; c<COLS; c++) {
        const txtDiv = children[idx].firstElementChild;
        txtDiv.textContent = formatRgbText(colors[r][c]);
        idx++;
      }
    }
  }

  outputGrid.addEventListener('mouseover', (e) => {
    const cell = e.target.closest('.output-pixel');
    if (!cell) return;
    const idx = Array.from(outputGrid.children).indexOf(cell);
    const r = Math.floor(idx / COLS), c = idx % COLS;
    cell.style.background = colors[r][c];
  });
  outputGrid.addEventListener('mouseout', (e) => {
    const cell = e.target.closest('.output-pixel');
    if (!cell) return;
    cell.style.background = '#f8fafc';
  });

  // مطمئن شو خروجی اولیه هماهنگه
  updateOutputs();

</script>
</body>
</html>