<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NOT Gate Mini-Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <style>
      @font-face {
        font-family: "Vazir";
        src: url("https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.woff")
          format("woff");
        font-display: swap;
      }

      /* Base = small screens (stack + shrink) */
      :root {
        font-family: "Vazir";
        --box-w: clamp(220px, 90vw, 300px);
        --box-h: clamp(300px, 70vh, 400px);
        --radius: 14px;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.12);
      }

      /* sm */
      @media (min-width: 640px) {
        :root {
          --box-w: 280px;
          --box-h: 420px;
        }
      }

      /* md: single row */
      @media (min-width: 768px) {
        :root {
          --box-w: 320px;
          --box-h: 450px;
        }
      }

      /* lg */
      @media (min-width: 1024px) {
        :root {
          --box-w: 340px;
          --box-h: 480px;
        }
      }

      /* Layout */
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        background: #fff;
        font-family: Vazir, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial, sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .wrap {
        display: flex;
        flex-direction: column;
        gap: 16px;
        width: 100%;
        max-width: 1100px;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap; /* allow wrap on small screens */
      }
      @media (min-width: 768px) {
        .wrap {
          flex-direction: row;
          flex-wrap: nowrap; /* single row on md and up */
          gap: 20px;
        }
      }

      /* Boxes */
      .box {
        flex: 1 1 auto;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 0; /* allow shrinking */
      }
      .card {
        width: var(--box-w);
        height: var(--box-h);
        background: #fff;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        margin: 0 2px;
      }
      .card-head {
        padding: 10px 14px;
        text-align: center;
        font-size: 20px;
        border-bottom: 1px solid #eee;
      }
      .card-body {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
      }

      /* Schematic content */
      .schematic-inner {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 16px;
      }
      .schematic-img {
        width: calc(var(--box-w) * 0.75);
        max-width: 90%;
        height: auto;
        display: block;
      }

      /* p5 canvas scales with the card */
      canvas {
        display: block;
        width: 100%;
        height: 100%;
        border-radius: 0;
      }
    </style>
  </head>
  <body>
    <div class="wrap" dir="ltr">

      <!-- Schematic box (DOM image, no p5 loadImage) -->
      <div class="box" dir="rtl">
        <div class="card">
          <div class="card-head">شماتیک گیت NOT</div>
          <div class="card-body">
            <div class="schematic-inner">
              <img class="schematic-img" src="NOT.png" alt="NOT Gate" />
            </div>
          </div>
        </div>
      </div>


      <!-- Circuit box -->
      <div class="box" dir="rtl">
        <div class="card">
          <div class="card-head">مدار تعاملی</div>
          <div class="card-body">
            <div id="circuit"></div>
          </div>
        </div>
      </div>


      <!-- Truth table box -->
      <div class="box" dir="rtl">
        <div class="card">
          <div class="card-head">جدول درستی</div>
          <div class="card-body">
            <div id="truth-table"></div>
          </div>
        </div>
      </div>




    </div>

    <script>
      /* shared state */
      let switchState = 0;

      /* fixed truth table: inputs locked; outputs toggle; results always shown */
      let table = [
        { input: 0, output: 0 },
        { input: 1, output: 0 },
      ];
      let results = [false, false];

      (function setupTruthTable() {
        const sketch = function (p) {
          const W = 320,
            H = 450;
          const startY = 60;
          const rowGap = 60;
          const cellW = 40,
            cellH = 40;
          const colGap = 80;

          const c1 = 75; // input center
          const c2 = c1 + colGap; // output center
          const c3 = c1 + 2 * colGap; // result center

          p.setup = function () {
            p.createCanvas(W, H);
            p.textAlign(p.CENTER, p.CENTER);
            p.textSize(16);
            p.textFont("Vazir");
          };

          p.draw = function () {
            p.clear();
            p.background(255);

            // headers
            p.textSize(18);
            p.fill(0);
            p.text("ورودی", c1, startY - 30);
            p.text("خروجی", c2, startY - 30);
            p.text("نتیجه", c3, startY - 30);

            // crisp column separators
            const yTop = startY - 40;
            const yBot = startY + (table.length - 1) * rowGap + cellH + 10;
            p.stroke(180);
            p.strokeWeight(1);
            p.line((c1 + c2) / 2 + 0.5, yTop, (c1 + c2) / 2 + 0.5, yBot);
            p.line((c2 + c3) / 2 + 0.5, yTop, (c2 + c3) / 2 + 0.5, yBot);

            // rows
            for (let i = 0; i < table.length; i++) {
              const y = startY + i * rowGap;

              // input cell (locked)
              p.noStroke();
              p.fill(
                table[i].input ? p.color(46, 204, 113) : p.color(242, 80, 58)
              );
              p.rect(c1 - cellW / 2, y, cellW, cellH, 10);
              p.fill(255);
              p.textSize(16);
              p.text(table[i].input, c1, y + cellH / 2);

              // output cell (interactive look)
              const outVal = table[i].output;
              p.stroke(outVal ? p.color(46, 204, 113) : p.color(242, 80, 58));
              p.strokeWeight(2);
              p.fill(255);
              p.rect(c2 - cellW / 2, y, cellW, cellH, 10);
              p.noStroke();
              p.fill(0);
              p.text(outVal, c2, y + cellH / 2);

              // p.fill(120); p.textSize(11);
              // p.text("کلیک کنید", c2, y + cellH + 12);

              // result cell (instant)
              results[i] = (table[i].input ^ table[i].output) === 1;
              p.textSize(22);
              p.fill(results[i] ? p.color(46, 204, 113) : p.color(242, 80, 58));
              p.text(results[i] ? "✅" : "❌", c3, y + cellH / 2);
            }

            // overall status text under rows
            const allValid =
              table[0].input === 0 &&
              table[0].output === 1 &&
              table[1].input === 1 &&
              table[1].output === 0;
            p.textSize(16);
            p.fill(allValid ? p.color(46, 204, 113) : p.color(242, 80, 58));
            p.text(allValid ? "پاسخ درست است" : "پاسخ نادرست است", c2, 315);
          };

          p.mousePressed = function () {
            // toggle outputs only
            for (let i = 0; i < table.length; i++) {
              const x0 = c2 - cellW / 2;
              const y0 = startY + i * rowGap;
              if (
                p.mouseX > x0 &&
                p.mouseX < x0 + cellW &&
                p.mouseY > y0 &&
                p.mouseY < y0 + cellH
              ) {
                table[i].output = 1 - table[i].output;
              }
            }
          };
        };
        new p5(sketch, "truth-table");
      })();

      /* Circuit sketch */
      (function setupCircuit() {
        const sketch = function (p) {
          const centerX = 160;
          const centerY = 200;
          const w = 150;
          const h = 90;

          let switchOn = false;

          p.setup = function () {
            p.createCanvas(320, 450);
            p.textAlign(p.CENTER, p.CENTER);
            p.textSize(16);
            p.textFont("Vazir");
          };

          p.draw = function () {
            p.clear();
            p.background(255);

            drawCircuit();
          };

          function drawCircuit() {
            // wires
            p.stroke(0);
            p.strokeWeight(3);
            p.noFill();
            p.line(
              centerX - w / 2,
              centerY - h / 2,
              centerX + w / 2,
              centerY - h / 2
            ); // top
            p.line(
              centerX + w / 2,
              centerY - h / 2,
              centerX + w / 2,
              centerY + h / 2
            ); // right
            p.line(
              centerX + w / 2,
              centerY + h / 2,
              centerX - w / 2,
              centerY + h / 2
            ); // bottom
            p.line(
              centerX - w / 2,
              centerY + h / 2,
              centerX - w / 2,
              centerY - h / 2
            ); // left

            const switchLen = 30;

            p.line(
              centerX + (w * 1) / 4,
              centerY + switchLen / 2,
              centerX + (w * 1) / 4,
              centerY + h / 2
            ); // right up

            p.line(
              centerX + (w * 1) / 4,
              centerY - h / 2,
              centerX + (w * 1) / 4,
              centerY - switchLen / 2
            ); // right down

            drawBattery(centerX - w / 2, centerY);
            drawResistor(centerX, centerY - h / 2);
            drawBulb(centerX + w / 2, centerY);
            // drawSwitch(centerX, centerY + h/2);
            drawSwitch2(centerX + (w * 1) / 4, centerY, switchLen);
          }

          function drawBattery(x, y) {
            p.push();
            p.translate(x, y);
            p.stroke(0);
            p.strokeWeight(4);
            p.line(-15, 0, 15, 0);
            p.strokeWeight(3);
            p.line(-10, 8, 10, 8);
            p.noStroke();
            p.fill(0);
            p.textSize(10);
            p.text("باتری", -30, 3);
            p.pop();
          }

          function drawResistor(x, y) {
            p.push();
            p.translate(x, y);
            p.stroke(0);
            p.strokeWeight(3);
            p.noFill();
            p.beginShape();
            p.vertex(-22, 0);
            p.vertex(-15, 0);
            p.vertex(-11, -8);
            p.vertex(-4, 8);
            p.vertex(4, -8);
            p.vertex(11, 8);
            p.vertex(15, 0);
            p.vertex(22, 0);
            p.endShape();
            p.noStroke();
            p.fill(0);
            p.textSize(10);
            p.text("مقاومت", 0, 20);
            p.text("R", 0, -15);
            p.pop();
          }

          function drawBulb(x, y) {
            p.push();
            p.translate(x, y);
            p.stroke(0);
            p.strokeWeight(2);
            p.fill(!switchOn ? p.color(255, 255, 0) : 255);
            p.ellipse(0, 0, 30, 30);
            p.stroke(!switchOn ? p.color(255, 150, 0) : 0);
            p.strokeWeight(!switchOn ? 2 : 1);
            p.line(-6, -6, 6, 6);
            p.line(-6, 6, 6, -6);
            p.noStroke();
            p.fill(0);
            p.textSize(10);
            p.text("لامپ", 35, 0);
            p.pop();
          }

          function drawSwitch(x, y) {
            p.push();
            p.translate(x, y);
            p.stroke(0);
            p.strokeWeight(3);
            p.fill(0);
            p.ellipse(-15, 0, 5, 5);
            p.ellipse(15, 0, 5, 5);

            if (switchOn) {
              p.stroke(0, 150, 0);
              p.strokeWeight(4);
              p.line(-15, 0, 15, 0);
            } else {
              p.stroke(255, 0, 0);
              p.strokeWeight(3);
              p.line(-15, 0, 10, -12);
            }

            p.noStroke();
            p.fill(0);
            p.textSize(10);
            p.text("سویچ", 0, 20);
            p.text(switchOn ? "بسته" : "باز", 0, 32);
            p.pop();
          }

          function drawSwitch2(x, y, swLen) {
            p.push();
            p.translate(x, y);
            p.stroke(0);
            p.strokeWeight(3);
            p.fill(0);
            p.ellipse(0, swLen / 2, 5, 5);
            p.ellipse(0, (-1 * swLen) / 2, 5, 5);

            if (switchOn) {
              p.stroke(0, 150, 0);
              p.strokeWeight(4);
              p.line(0, -swLen / 2, 0, swLen / 2);
            } else {
              p.stroke(255, 0, 0);
              p.strokeWeight(3);
              p.line(0, (1 * swLen) / 2, 10, (-1 * swLen) / 2);
            }

            p.noStroke();
            p.fill(0);
            p.textSize(10);
            p.text("سویچ", -20, 0);
            p.text(switchOn ? "بسته" : "باز", -20, 12);
            p.pop();
          }

          // const switchX = centerX + w * 1 / 4;
          // const switchY = centerY;
          // p.stroke(0); p.strokeWeight(3); p.fill(0);
          // p.ellipse(switchX, switchY, 20, 20);

          function handlePress(p) {
            const switchX = centerX + (w * 1) / 4;
            const switchY = centerY;

            const d = p.dist(p.mouseX, p.mouseY, switchX, switchY);
            if (d < 20) {
              switchOn = !switchOn;
              switchState = switchOn ? 1 : 0;
            }
          };

          p.touchStarted = function () {
            handlePress(p);
            handledTouch = true; // suppress the follow-up mousePressed
            return false; // prevent default scrolling/click synthesis
          };

          p.touchEnded = function () {
            // allow next interaction
            handledTouch = false;
          };

          p.mousePressed = function () {
            if (handledTouch || p.touches.length) return; // ignore duplicate from touch
            handlePress(p);
          };
        };
        new p5(sketch, "circuit");
      })();
    </script>
  </body>
</html>